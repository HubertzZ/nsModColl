/**
 * Copyright 2020 Hubert Z.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy of
 * this software and associated documentation files (the "Software"), to deal in
 * the Software without restriction, including without limitation the rights to
 * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of
 * the Software, and to permit persons to whom the Software is furnished to do so,
 * subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
 * FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
 * COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
 * IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
 * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 *
 * @NApiVersion 2.x
 */
define(["require","exports","./cryptojs","./secret"],function(t,e,r,n){Object.defineProperty(e,"__esModule",{value:!0}),e.getHeaders=e.OAuth=void 0;var o=(i.prototype.authorize=function(t,e){var r={oauth_consumer_key:this.consumer.key,oauth_nonce:this.getNonce(),oauth_signature_method:this.signature_method,oauth_timestamp:this.getTimeStamp(),oauth_version:this.version};return(e=e||{}).key&&(r.oauth_token=e.key),t.data||(t.data={}),r.oauth_signature=this.getSignature(t,e.secret,r),r},i.prototype.getSignature=function(t,e,r){return this.hash_function(this.getBaseString(t,r),this.getSigningKey(e))},i.prototype.getBaseString=function(t,e){return t.method.toUpperCase()+"&"+this.percentEncode(this.getBaseUrl(t.url))+"&"+this.percentEncode(this.getParameterString(t,e))},i.prototype.getParameterString=function(t,e){var r,i=this.sortObject(this.percentEncodeData(this.mergeObject(e,this.mergeObject(t.data,this.deParamUrl(t.url))))),a="",s=this;for(r in i)!function(r){var n,o=i[r];o&&Array.isArray(o)?(o.sort(),n="",o.forEach(function(t,e){n+=r+"="+t,e<o.length&&(n+="&")}.bind(s)),a+=n):a+=r+"="+o+"&"}(r);return a=a.substr(0,a.length-1)},i.prototype.getSigningKey=function(t){return t=t||"",this.last_ampersand||t?this.percentEncode(this.consumer.secret)+"&"+this.percentEncode(t):this.percentEncode(this.consumer.secret)},i.prototype.getBaseUrl=function(t){return t.split("?")[0]},i.prototype.deParam=function(t){for(var e=t.split("&"),r={},n=0;n<e.length;n++){var o=e[n].split("=");o[1]=o[1]||"",r[o[0]]=decodeURIComponent(o[1])}return r},i.prototype.deParamUrl=function(t){t=t.split("?");return 1===t.length?{}:this.deParam(t[1])},i.prototype.percentEncode=function(t){return encodeURIComponent(t).replace(/\!/g,"%21").replace(/\*/g,"%2A").replace(/\'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29")},i.prototype.percentEncodeData=function(n){var t,o={},i=this;for(t in n)!function(t){var e,r=(r=n[t])&&Array.isArray(r)?(e=[],r.forEach(function(t){e.push(this.percentEncode(t))}.bind(i)),e):i.percentEncode(r);o[i.percentEncode(t)]=r}(t);return o},i.prototype.toHeader=function(t){t=this.sortObject(t);var e,r="OAuth ";for(e in this.realm&&(r+=this.percentEncode("realm")+'="'+this.percentEncode(this.realm)+'"'+this.parameter_separator),t)-1!==e.indexOf("oauth_")&&(r+=this.percentEncode(e)+'="'+this.percentEncode(t[e])+'"'+this.parameter_separator);return{Authorization:r.substr(0,r.length-this.parameter_separator.length)}},i.prototype.getNonce=function(){for(var t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",e="",r=0;r<this.nonce_length;r++)e+=t[parseInt((Math.random()*t.length).toString(),10)];return e},i.prototype.getTimeStamp=function(){return parseInt(((new Date).getTime()/1e3).toString(),10)},i.prototype.mergeObject=function(t,e){var r,n=t=t||{};for(r in e=e||{})n[r]=e[r];return n},i.prototype.sortObject=function(t){var e=Object.keys(t),r={};e.sort();for(var n=0,o=e;n<o.length;n++){var i=o[n];r[i]=t[i]}return r},i);function i(t){if(!(t=t||{}).consumer)throw new Error("consumer option is required");if(this.consumer=t.consumer,this.nonce_length=t.nonce_length||32,this.version=t.version||"1.0",this.realm=t.realm||"",this.parameter_separator=t.parameter_separator||", ",this.last_ampersand=void 0===t.last_ampersand||t.last_ampersand,this.signature_method=t.signature_method||"PLAINTEXT","PLAINTEXT"!=this.signature_method||t.hash_function||(t.hash_function=function(t,e){return e}),!t.hash_function)throw new Error("hash_function option is required");this.hash_function=t.hash_function}e.OAuth=o;var a=new o({realm:n.realm,consumer:{key:n.consumer.public,secret:n.consumer.secret},signature_method:"HMAC-SHA256",hash_function:function(t,e){return r.HmacSHA256(t,e).toString(r.enc.Base64)}});e.getHeaders=function(t){var e="GET"===t.method.toUpperCase()?function(t){if("string"!=typeof t)throw TypeError("getQueryParams requires a String argument.");var e={};if(-1===t.indexOf("?"))return e;for(var r=0,n=(t=t.split("#")[0]).split("?")[1].split("&");r<n.length;r++){var o=n[r].split("="),i=o[0],o=o[1];i in e?("string"==typeof e[i]&&(e[i]=[e[i]]),e[i].push(o)):e[i]=o}return e}(t.url):void 0,e={url:t.url,method:t.method,data:e},t={key:t.tokenKey,secret:t.tokenSecret};return a.toHeader(a.authorize(e,t))}});
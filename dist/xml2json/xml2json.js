/**
 * Copyright 2020 Hubert Z.
 * Copyright 2006 Stefan Goessner
 *
 * This file is free software: you can redistribute it and/or
 * modify it under the terms of the GNU General Lesser Public
 * License as published by the Free Software Foundation, either
 * version 3 of the License, or (at your option) any later version.
 *
 * This file is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this file.
 * If not, see <https://www.gnu.org/licenses/lgpl-3.0.html>.
 *
 * @NApiVersion 2.x
 */
define(["require","exports","N"],function(e,n,a){Object.defineProperty(n,"__esModule",{value:!0}),n.json2xml=n.xml2json=void 0,n.xml2json=function(e){var d={toObj:function(e){var n={};if(e.nodeType==a.xml.NodeType.ELEMENT_NODE){if(e.attributes.length)for(var t=0;t<e.attributes.length;t++)n["@"+e.attributes[t].nodeName]=(e.attributes[t].nodeValue||"").toString();if(e.firstChild){for(var o=0,r=0,i=!1,l=e.firstChild;l;l=l.nextSibling)l.nodeType==a.xml.NodeType.ELEMENT_NODE?i=!0:l.nodeType==a.xml.NodeType.TEXT_NODE&&l.nodeValue.match(/[^ \f\n\r\t\v]/)?o++:l.nodeType==a.xml.NodeType.CDATA_SECTION_NODE&&r++;if(i)if(o<2&&r<2){d.removeWhite(e);for(l=e.firstChild;l;l=l.nextSibling)l.nodeType==a.xml.NodeType.TEXT_NODE?n["#text"]=d.escape(l.nodeValue):l.nodeType==a.xml.NodeType.CDATA_SECTION_NODE?n["#cdata"]=d.escape(l.nodeValue):n[l.nodeName]?n[l.nodeName]instanceof Array?n[l.nodeName][n[l.nodeName].length]=d.toObj(l):n[l.nodeName]=[n[l.nodeName],d.toObj(l)]:n[l.nodeName]=d.toObj(l)}else e.attributes.length?n["#text"]=d.escape(d.innerXml(e)):n=d.escape(d.innerXml(e));else if(o)e.attributes.length?n["#text"]=d.escape(d.innerXml(e)):n=d.escape(d.innerXml(e));else if(r)if(1<r)n=d.escape(d.innerXml(e));else for(l=e.firstChild;l;l=l.nextSibling)n["#cdata"]=d.escape(l.nodeValue)}e.attributes.length||e.firstChild||(n=null)}else e.nodeType==a.xml.NodeType.DOCUMENT_NODE?n=d.toObj(e.documentElement):a.log.error("unhandled node type",e.nodeType);return n},toJson:function(e,n,t){var o=n?'"'+n+'"':"";if(e instanceof Array){for(var r=0,i=e.length;r<i;r++)e[r]=d.toJson(e[r],"",t+"\t");o+=(n?":[":"[")+(1<e.length?"\n"+t+"\t"+e.join(",\n"+t+"\t")+"\n"+t:e.join(""))+"]"}else if(null==e)o+=(n&&":")+"null";else if("object"==typeof e){var l,a=[];for(l in e)a[a.length]=d.toJson(e[l],l,t+"\t");o+=(n?":{":"{")+(1<a.length?"\n"+t+"\t"+a.join(",\n"+t+"\t")+"\n"+t:a.join(""))+"}"}else o+="string"==typeof e?(n&&":")+'"'+e.toString()+'"':(n&&":")+e.toString();return o},innerXml:function(e){var n="";if("innerHTML"in e)n=e.innerHTML;else for(var r=function(e){var n="";if(e.nodeType==a.xml.NodeType.ELEMENT_NODE){n+="<"+e.nodeName;for(var t=0;t<e.attributes.length;t++)n+=" "+e.attributes[t].nodeName+'="'+(e.attributes[t].nodeValue||"").toString()+'"';if(e.firstChild){n+=">";for(var o=e.firstChild;o;o=o.nextSibling)n+=r(o);n+="</"+e.nodeName+">"}else n+="/>"}else e.nodeType==a.xml.NodeType.TEXT_NODE?n+=e.nodeValue:e.nodeType==a.xml.NodeType.CDATA_SECTION_NODE&&(n+="<![CDATA["+e.nodeValue+"]]>");return n},t=e.firstChild;t;t=t.nextSibling)n+=r(t);return n},escape:function(e){return e.replace(/[\\]/g,"\\\\").replace(/[\"]/g,'\\"').replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r")},removeWhite:function(e){e.normalize();for(var n,t=e.firstChild;t;)t=t.nodeType==a.xml.NodeType.TEXT_NODE?t.nodeValue.match(/[^ \f\n\r\t\v]/)?t.nextSibling:(n=t.nextSibling,e.removeChild(t),n):(t.nodeType==a.xml.NodeType.ELEMENT_NODE&&d.removeWhite(t),t.nextSibling);return e}};return e.nodeType==a.xml.NodeType.DOCUMENT_NODE&&(e=e.documentElement),"{"+d.toJson(d.toObj(d.removeWhite(e)),e.nodeName,"\t").replace(/\t|\n/g,"")+"}"},n.json2xml=function(e){var n,d=function(e,n,t){var o="";if(e instanceof Array)for(var r=0,i=e.length;r<i;r++)o+=t+d(e[r],n,t+"\t")+"\n";else if("object"==typeof e){var l=!1;for(a in o+=t+"<"+n,e)"@"==a.charAt(0)?o+=" "+a.substr(1)+'="'+e[a].toString()+'"':l=!0;if(o+=l?">":"/>",l){for(var a in e)"#text"==a?o+=e[a]:"#cdata"==a?o+="<![CDATA["+e[a]+"]]>":"@"!=a.charAt(0)&&(o+=d(e[a],a,t+"\t"));o+=("\n"==o.charAt(o.length-1)?t:"")+"</"+n+">"}}else"function"!=typeof e&&(o+=t+"<"+n+">"+e.toString()+"</"+n+">");return o},t="";for(n in e)t+=d(e[n],n,"");return t.replace(/\t|\n/g,"")}});